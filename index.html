<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jones College of Business GPA Calculator</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const PlusCircle = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="16"></line>
                <line x1="8" y1="12" x2="16" y2="12"></line>
            </svg>
        );

        const Trash2 = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
        );

        function MTSUGPACalculator() {
            const [semesters, setSemesters] = useState([]);
            const [showGoalPlanner, setShowGoalPlanner] = useState(false);
            const [showCandidacy, setShowCandidacy] = useState(false);
            const [currentGPA, setCurrentGPA] = useState('');
            const [currentCredits, setCurrentCredits] = useState('');
            const [goalGPA, setGoalGPA] = useState('');
            const [plannedCredits, setPlannedCredits] = useState('');
            const [duplicateDialog, setDuplicateDialog] = useState(null);
            const [activeSemester, setActiveSemester] = useState(0);
            const [colorScheme, setColorScheme] = useState('blue');
            const [showPDFDialog, setShowPDFDialog] = useState(false);
            const [studentName, setStudentName] = useState('');
            const [studentMNumber, setStudentMNumber] = useState('');
            
            const [candidacyGrades, setCandidacyGrades] = useState({
                'ECON 2410': '',
                'ECON 2420': '',
                'BIA 2610': '',
                'ACTG 2110': ''
            });

            const colorSchemes = {
                blue: {
                    name: 'MTSU Blue (Default)',
                    mood: 'Professional & Trustworthy',
                    header: 'linear-gradient(135deg, #03045e 0%, #0077b6 100%)',
                    subtitle: '#90e0ef',
                    navButton1: '#0077b6',  // Calculate GPA - primary blue
                    navButton2: '#00b4d8',  // Goal Planner - lighter blue
                    navButton3: '#0096c7',  // Jones Candidacy - mid blue
                    addButton: '#48cae4',   // Add Semester - lightest blue
                    activeTab: '#023e8a',   // Active semester tab
                    card1: 'linear-gradient(135deg, #0077b6 0%, #0096c7 100%)',
                    card2: 'linear-gradient(135deg, #00b4d8 0%, #48cae4 100%)',
                    card3: 'linear-gradient(135deg, #023e8a 0%, #0077b6 100%)',
                    card4: 'linear-gradient(135deg, #0096c7 0%, #00b4d8 100%)',
                    infoBox: '#48cae4',
                    actionButton: '#0077b6'  // Add Course, Reset buttons
                },
                mono: {
                    name: 'Monochrome + Accent',
                    mood: 'Corporate & Elegant',
                    header: 'linear-gradient(135deg, #2d3748 0%, #4a5568 100%)',
                    subtitle: '#e2e8f0',
                    navButton1: '#718096',  // gray-blue
                    navButton2: '#a0aec0',  // light gray
                    navButton3: '#4a5568',  // medium gray
                    addButton: '#f56565',   // red accent
                    activeTab: '#2d3748',
                    card1: 'linear-gradient(135deg, #4a5568 0%, #718096 100%)',
                    card2: 'linear-gradient(135deg, #718096 0%, #a0aec0 100%)',
                    card3: 'linear-gradient(135deg, #2d3748 0%, #4a5568 100%)',
                    card4: 'linear-gradient(135deg, #a0aec0 0%, #cbd5e0 100%)',
                    infoBox: '#cbd5e0',
                    actionButton: '#4a5568'
                },
                olive: {
                    name: 'Olive Garden Feast',
                    mood: 'Warm & Rustic',
                    header: 'linear-gradient(135deg, #283618 0%, #606c38 100%)',
                    subtitle: '#fefae0',
                    navButton1: '#606c38',  // olive green
                    navButton2: '#dda15e',  // golden tan
                    navButton3: '#bc6c25',  // burnt orange
                    addButton: '#dda15e',   // golden tan
                    activeTab: '#283618',   // dark forest
                    card1: 'linear-gradient(135deg, #606c38 0%, #283618 100%)',
                    card2: 'linear-gradient(135deg, #dda15e 0%, #fefae0 100%)',
                    card3: 'linear-gradient(135deg, #bc6c25 0%, #dda15e 100%)',
                    card4: 'linear-gradient(135deg, #606c38 0%, #dda15e 100%)',
                    infoBox: '#dda15e',
                    actionButton: '#606c38'
                },
                fiery: {
                    name: 'Fiery Ocean',
                    mood: 'Bold & Contrasting',
                    header: 'linear-gradient(135deg, #780000 0%, #003049 100%)',
                    subtitle: '#fdf0d5',
                    navButton1: '#c1121f',  // bright red (solid)
                    navButton2: '#003049',  // deep ocean blue (solid)
                    navButton3: '#669bbc',  // light ocean blue (solid)
                    addButton: '#780000',   // dark red (solid)
                    activeTab: '#780000',   // dark red
                    card1: 'linear-gradient(135deg, #c1121f 0%, #780000 100%)',
                    card2: 'linear-gradient(135deg, #003049 0%, #669bbc 100%)',
                    card3: 'linear-gradient(135deg, #780000 0%, #c1121f 100%)',
                    card4: 'linear-gradient(135deg, #669bbc 0%, #fdf0d5 100%)',
                    infoBox: '#669bbc',
                    actionButton: '#003049'
                },
                golden: {
                    name: 'Golden Summer Fields',
                    mood: 'Soft & Peaceful',
                    header: 'linear-gradient(135deg, #d4a373 0%, #ccd5ae 100%)',
                    subtitle: '#fefae0',
                    navButton1: '#ccd5ae',  // sage green (solid)
                    navButton2: '#e9edc9',  // pale green (solid)
                    navButton3: '#faedcd',  // cream (solid)
                    addButton: '#d4a373',   // tan brown (solid)
                    activeTab: '#d4a373',   // tan brown
                    card1: '#ccd5ae',       // sage green (solid)
                    card2: '#e9edc9',       // pale green (solid)
                    card3: '#faedcd',       // cream (solid)
                    card4: '#d4a373',       // tan brown (solid)
                    infoBox: '#faedcd',
                    actionButton: '#ccd5ae',
                    cardText: '#2c3e1f',    // dark green text for cards
                    buttonText: '#2c3e1f'   // dark green text for buttons
                },
                earth: {
                    name: 'Muted Earth Tones',
                    mood: 'Calm & Natural',
                    header: 'linear-gradient(135deg, #3e2723 0%, #5d4037 100%)',
                    subtitle: '#d7ccc8',
                    navButton1: '#6d4c41',  // warm brown
                    navButton2: '#7cb342',  // forest green
                    navButton3: '#8d6e63',  // clay
                    addButton: '#9ccc65',   // light green
                    activeTab: '#4e342e',
                    card1: 'linear-gradient(135deg, #6d4c41 0%, #8d6e63 100%)',
                    card2: 'linear-gradient(135deg, #7cb342 0%, #9ccc65 100%)',
                    card3: 'linear-gradient(135deg, #5d4037 0%, #6d4c41 100%)',
                    card4: 'linear-gradient(135deg, #8d6e63 0%, #a1887f 100%)',
                    infoBox: '#9ccc65',
                    actionButton: '#6d4c41'
                },
                pastel: {
                    name: 'Soft Pastels + Bold Accent',
                    mood: 'Modern & Airy',
                    header: 'linear-gradient(135deg, #4a148c 0%, #7b1fa2 100%)',
                    subtitle: '#f3e5f5',
                    navButton1: '#ce93d8',  // soft purple
                    navButton2: '#90caf9',  // soft blue
                    navButton3: '#a5d6a7',  // soft green
                    addButton: '#7b1fa2',   // bold purple accent
                    activeTab: '#6a1b9a',
                    card1: 'linear-gradient(135deg, #ce93d8 0%, #e1bee7 100%)',
                    card2: 'linear-gradient(135deg, #90caf9 0%, #bbdefb 100%)',
                    card3: 'linear-gradient(135deg, #a5d6a7 0%, #c8e6c9 100%)',
                    card4: 'linear-gradient(135deg, #ba68c8 0%, #ce93d8 100%)',
                    infoBox: '#e1bee7',
                    actionButton: '#ab47bc'
                },
                dark: {
                    name: 'Dark Mode Professional',
                    mood: 'Sophisticated & Modern',
                    header: 'linear-gradient(135deg, #0d1b2a 0%, #1b263b 100%)',
                    subtitle: '#e0e1dd',
                    navButton1: '#415a77',  // steel blue
                    navButton2: '#778da9',  // light steel
                    navButton3: '#0d1b2a',  // deep navy
                    addButton: '#778da9',   // light steel (changed from gold)
                    activeTab: '#1b263b',
                    card1: 'linear-gradient(135deg, #415a77 0%, #778da9 100%)',
                    card2: 'linear-gradient(135deg, #778da9 0%, #e0e1dd 100%)',
                    card3: 'linear-gradient(135deg, #1b263b 0%, #415a77 100%)',
                    card4: 'linear-gradient(135deg, #0d1b2a 0%, #415a77 100%)',
                    infoBox: '#778da9',
                    actionButton: '#415a77'
                },
                neon: {
                    name: 'Neon Gradient Tech',
                    mood: 'Energetic & Futuristic',
                    header: 'linear-gradient(135deg, #6a00f4 0%, #c471ed 100%)',
                    subtitle: '#f72585',
                    navButton1: '#7209b7',  // deep purple
                    navButton2: '#f72585',  // hot pink
                    navButton3: '#4cc9f0',  // cyan
                    addButton: '#4361ee',   // electric blue
                    activeTab: '#560bad',
                    card1: 'linear-gradient(135deg, #7209b7 0%, #b5179e 100%)',
                    card2: 'linear-gradient(135deg, #f72585 0%, #c9184a 100%)',
                    card3: 'linear-gradient(135deg, #4cc9f0 0%, #4895ef 100%)',
                    card4: 'linear-gradient(135deg, #4361ee 0%, #7209b7 100%)',
                    infoBox: '#c471ed',
                    actionButton: '#7209b7'
                }
            };

            const currentColors = colorSchemes[colorScheme];

            const gradePoints = {
                'A': 4.0,
                'B+': 3.33,
                'B': 3.0,
                'B-': 2.67,
                'C+': 2.33,
                'C': 2.0,
                'C-': 1.67,
                'D+': 1.33,
                'D': 1.0,
                'D-': 0.67,
                'F': 0.0,
                'FA': 0.0,
                'W': null
            };

            useEffect(() => {
                const savedData = localStorage.getItem('mtsuGPAData');
                const savedTheme = localStorage.getItem('mtsuColorTheme');
                
                if (savedTheme) {
                    setColorScheme(savedTheme);
                }
                
                if (savedData) {
                    try {
                        const parsed = JSON.parse(savedData);
                        setSemesters(parsed.semesters || []);
                        setActiveSemester(parsed.activeSemester || 0);
                    } catch (e) {
                        initializeFirstSemester();
                    }
                } else {
                    initializeFirstSemester();
                }
            }, []);

            useEffect(() => {
                if (semesters.length > 0) {
                    localStorage.setItem('mtsuGPAData', JSON.stringify({
                        semesters,
                        activeSemester
                    }));
                }
            }, [semesters, activeSemester]);

            useEffect(() => {
                localStorage.setItem('mtsuColorTheme', colorScheme);
            }, [colorScheme]);

            const initializeFirstSemester = () => {
                setSemesters([{
                    id: Date.now(),
                    name: 'Fall 2025',
                    courses: [{ id: 1, name: '', credits: '', grade: '' }]
                }]);
                setActiveSemester(0);
            };

            const addSemester = () => {
                let newSemesterName = 'Fall 2025';
                
                if (semesters.length > 0) {
                    const lastSemester = semesters[semesters.length - 1].name.toLowerCase();
                    const yearMatch = lastSemester.match(/\d{4}/);
                    const currentYear = yearMatch ? parseInt(yearMatch[0]) : new Date().getFullYear();
                    
                    if (lastSemester.includes('fall')) {
                        newSemesterName = `Spring ${currentYear + 1}`;
                    } else if (lastSemester.includes('spring')) {
                        newSemesterName = `Summer ${currentYear}`;
                    } else if (lastSemester.includes('summer')) {
                        newSemesterName = `Fall ${currentYear}`;
                    } else {
                        newSemesterName = `Semester ${semesters.length + 1}`;
                    }
                }
                
                const newSemester = {
                    id: Date.now(),
                    name: newSemesterName,
                    courses: [{ id: Date.now(), name: '', credits: '', grade: '' }]
                };
                setSemesters([...semesters, newSemester]);
                setActiveSemester(semesters.length);
            };

            const removeSemester = (index) => {
                if (semesters.length > 1) {
                    const newSemesters = semesters.filter((_, i) => i !== index);
                    setSemesters(newSemesters);
                    if (activeSemester >= newSemesters.length) {
                        setActiveSemester(newSemesters.length - 1);
                    }
                }
            };

            const updateSemesterName = (index, newName) => {
                const newSemesters = [...semesters];
                newSemesters[index].name = newName;
                setSemesters(newSemesters);
            };

            const addCourse = (semesterIndex) => {
                const newSemesters = [...semesters];
                newSemesters[semesterIndex].courses.push({
                    id: Date.now(),
                    name: '',
                    credits: '',
                    grade: ''
                });
                setSemesters(newSemesters);
            };

            const removeCourse = (semesterIndex, courseId) => {
                const newSemesters = [...semesters];
                if (newSemesters[semesterIndex].courses.length > 1) {
                    newSemesters[semesterIndex].courses = newSemesters[semesterIndex].courses.filter(
                        course => course.id !== courseId
                    );
                    setSemesters(newSemesters);
                }
            };

            const updateCourse = (semesterIndex, courseId, field, value) => {
                const newSemesters = [...semesters];
                newSemesters[semesterIndex].courses = newSemesters[semesterIndex].courses.map(course =>
                    course.id === courseId ? { ...course, [field]: value } : course
                );
                setSemesters(newSemesters);
            };

            const checkForDuplicate = (semesterIndex, courseId, courseName) => {
                const normalizedValue = courseName.replace(/\s*\(R\)\s*$/i, '').trim().toLowerCase();
                
                if (normalizedValue === '') return;
                
                let duplicate = null;
                let duplicateSemesterIndex = -1;
                
                for (let i = 0; i < semesters.length; i++) {
                    const found = semesters[i].courses.find(c =>
                        c.id !== courseId &&
                        c.name.replace(/\s*\(R\)\s*$/i, '').trim().toLowerCase() === normalizedValue
                    );
                    if (found) {
                        duplicate = found;
                        duplicateSemesterIndex = i;
                        break;
                    }
                }

                if (duplicate) {
                    setDuplicateDialog({
                        semesterIndex,
                        courseId,
                        courseName: normalizedValue,
                        duplicateSemesterIndex,
                        duplicateId: duplicate.id,
                        duplicateName: duplicate.name.replace(/\s*\(R\)\s*$/i, '')
                    });
                }
            };

            const handleDuplicateResponse = (isRepeated) => {
                const { semesterIndex, courseId, courseName } = duplicateDialog;
                
                if (!isRepeated) {
                    removeCourse(semesterIndex, courseId);
                } else {
                    const newSemesters = [...semesters];
                    const baseName = courseName.replace(/\s*\(R\)\s*$/i, '').trim();
                    
                    // Mark all instances of this course with (R)
                    for (let i = 0; i < newSemesters.length; i++) {
                        newSemesters[i].courses = newSemesters[i].courses.map(course => {
                            const courseBaseName = course.name.replace(/\s*\(R\)\s*$/i, '').trim();
                            if (courseBaseName.toLowerCase() === baseName.toLowerCase()) {
                                return { ...course, name: courseBaseName + ' (R)', isRepeated: true };
                            }
                            return course;
                        });
                    }
                    
                    setSemesters(newSemesters);
                }
                
                setDuplicateDialog(null);
            };

            const calculateSemesterGPA = (semesterIndex) => {
                let totalPoints = 0;
                let totalCredits = 0;

                const courseGroups = {};
                
                semesters[semesterIndex].courses.forEach(course => {
                    const credits = parseFloat(course.credits);
                    const grade = course.grade;
                    
                    if (credits && grade && gradePoints[grade] !== undefined && gradePoints[grade] !== null) {
                        const baseName = course.name.replace(/\s*\(R\)\s*$/i, '').trim().toLowerCase();
                        
                        if (!courseGroups[baseName]) {
                            courseGroups[baseName] = [];
                        }
                        
                        courseGroups[baseName].push({
                            credits: credits,
                            gradePoints: gradePoints[grade],
                            courseIndex: semesters[semesterIndex].courses.indexOf(course)
                        });
                    }
                });

                // For semester GPA, if there are duplicates in the same semester, use the last one entered
                Object.values(courseGroups).forEach(group => {
                    if (group.length === 1) {
                        totalPoints += group[0].credits * group[0].gradePoints;
                        totalCredits += group[0].credits;
                    } else {
                        // Use the last one (highest courseIndex)
                        const lastEntry = group.reduce((latest, current) =>
                            current.courseIndex > latest.courseIndex ? current : latest
                        );
                        totalPoints += lastEntry.credits * lastEntry.gradePoints;
                        totalCredits += lastEntry.credits;
                    }
                });

                return totalCredits > 0 ? (totalPoints / totalCredits).toFixed(3) : '0.000';
            };

            const calculateCumulativeGPA = () => {
                let totalPoints = 0;
                let totalCredits = 0;

                const courseGroups = {};
                
                semesters.forEach((semester, semIndex) => {
                    semester.courses.forEach((course, courseIndex) => {
                        const credits = parseFloat(course.credits);
                        const grade = course.grade;
                        
                        if (credits && grade && gradePoints[grade] !== undefined && gradePoints[grade] !== null) {
                            const baseName = course.name.replace(/\s*\(R\)\s*$/i, '').trim().toLowerCase();
                            
                            if (!courseGroups[baseName]) {
                                courseGroups[baseName] = [];
                            }
                            
                            courseGroups[baseName].push({
                                credits: credits,
                                grade: grade,
                                gradePoints: gradePoints[grade],
                                semesterIndex: semIndex,
                                courseIndex: courseIndex,
                                isRepeated: course.name.match(/\(R\)\s*$/i) !== null
                            });
                        }
                    });
                });

                Object.values(courseGroups).forEach(group => {
                    if (group.length === 1) {
                        totalPoints += group[0].credits * group[0].gradePoints;
                        totalCredits += group[0].credits;
                    } else if (group.length === 2 || group.length === 3) {
                        // Find the most recent one (latest semester, or if same semester, latest courseIndex)
                        const mostRecent = group.reduce((latest, current) => {
                            if (current.semesterIndex > latest.semesterIndex) {
                                return current;
                            } else if (current.semesterIndex === latest.semesterIndex && current.courseIndex > latest.courseIndex) {
                                return current;
                            }
                            return latest;
                        });
                        totalPoints += mostRecent.credits * mostRecent.gradePoints;
                        totalCredits += mostRecent.credits;
                    } else {
                        group.forEach(attempt => {
                            totalPoints += attempt.credits * attempt.gradePoints;
                            totalCredits += attempt.credits;
                        });
                    }
                });

                return totalCredits > 0 ? (totalPoints / totalCredits).toFixed(3) : '0.000';
            };

            const getTotalCredits = () => {
                let attempted = 0;
                const courseGroups = {};
                
                // Count all attempts as attempted credits
                semesters.forEach(semester => {
                    semester.courses.forEach(course => {
                        const credits = parseFloat(course.credits);
                        if (credits) {
                            attempted += credits;
                        }
                    });
                });
                
                // For earned credits, group by course name and only count the most recent passing grade
                semesters.forEach((semester, semIndex) => {
                    semester.courses.forEach((course, courseIndex) => {
                        const credits = parseFloat(course.credits);
                        const grade = course.grade;
                        
                        if (credits && grade) {
                            const baseName = course.name.replace(/\s*\(R\)\s*$/i, '').trim().toLowerCase();
                            
                            if (!courseGroups[baseName]) {
                                courseGroups[baseName] = [];
                            }
                            
                            courseGroups[baseName].push({
                                credits: credits,
                                grade: grade,
                                semesterIndex: semIndex,
                                courseIndex: courseIndex
                            });
                        }
                    });
                });
                
                let earned = 0;
                Object.values(courseGroups).forEach(group => {
                    if (group.length === 1) {
                        // Single attempt - count if passing
                        if (group[0].grade && group[0].grade !== 'F' && group[0].grade !== 'FA' && group[0].grade !== 'W') {
                            earned += group[0].credits;
                        }
                    } else if (group.length === 2 || group.length === 3) {
                        // 2-3 attempts - only count credits from most recent attempt if passing
                        const mostRecent = group.reduce((latest, current) => {
                            if (current.semesterIndex > latest.semesterIndex) {
                                return current;
                            } else if (current.semesterIndex === latest.semesterIndex && current.courseIndex > latest.courseIndex) {
                                return current;
                            }
                            return latest;
                        });
                        if (mostRecent.grade && mostRecent.grade !== 'F' && mostRecent.grade !== 'FA' && mostRecent.grade !== 'W') {
                            earned += mostRecent.credits;
                        }
                    } else {
                        // 4+ attempts - count credits from each passing attempt
                        group.forEach(attempt => {
                            if (attempt.grade && attempt.grade !== 'F' && attempt.grade !== 'FA' && attempt.grade !== 'W') {
                                earned += attempt.credits;
                            }
                        });
                    }
                });
                
                return { earned: earned.toFixed(1), attempted: attempted.toFixed(1) };
            };

            const calculateCandidacyStatus = () => {
                const courses = ['ECON 2410', 'ECON 2420', 'BIA 2610', 'ACTG 2110'];
                const grades = courses.map(course => candidacyGrades[course]).filter(g => g !== '');
                
                if (grades.length === 0) return null;
                
                let totalPoints = 0;
                grades.forEach(grade => {
                    if (gradePoints[grade] !== undefined && gradePoints[grade] !== null) {
                        totalPoints += gradePoints[grade];
                    }
                });
                const currentCandidacyGPA = grades.length > 0 ? totalPoints / grades.length : 0;
                
                if (grades.length === 4) {
                    if (currentCandidacyGPA >= 2.25) {
                        return {
                            success: true,
                            gpa: currentCandidacyGPA.toFixed(3),
                            message: `Congratulations! Your pre-business course GPA is ${currentCandidacyGPA.toFixed(3)}, which meets the 2.25 requirement. Make sure you've also completed 30+ semester hours and have an inclusive GPA ≥ 2.25, then complete your Jones College Admission Application.`
                        };
                    } else {
                        const courseGrades = courses.map(course => ({
                            course,
                            grade: candidacyGrades[course],
                            points: gradePoints[candidacyGrades[course]]
                        }));
                        
                        courseGrades.sort((a, b) => a.points - b.points);
                        const lowestCourse = courseGrades[0];
                        
                        const otherThreeTotal = courseGrades.slice(1).reduce((sum, cg) => sum + cg.points, 0);
                        const neededPoints = (2.25 * 4) - otherThreeTotal;
                        
                        let recommendedGrade = 'D-';
                        let minDiff = Math.abs(gradePoints['D-'] - neededPoints);
                        
                        for (const [grade, points] of Object.entries(gradePoints)) {
                            if (grade === 'FA' || grade === 'F' || grade === 'W') continue;
                            const diff = Math.abs(points - neededPoints);
                            if (diff < minDiff && points >= neededPoints) {
                                minDiff = diff;
                                recommendedGrade = grade;
                            }
                        }
                        
                        return {
                            success: false,
                            gpa: currentCandidacyGPA.toFixed(3),
                            lowestCourse: lowestCourse.course,
                            currentGrade: lowestCourse.grade,
                            neededGrade: recommendedGrade,
                            message: `Your current candidacy GPA is ${currentCandidacyGPA.toFixed(3)}, which is below the 2.25 requirement. We recommend repeating ${lowestCourse.course} (current grade: ${lowestCourse.grade}). You would need to earn at least a ${recommendedGrade} (${gradePoints[recommendedGrade].toFixed(2)}) to reach the 2.25 pre-business course GPA requirement.`
                        };
                    }
                } else {
                    const remaining = 4 - grades.length;
                    const neededTotal = 2.25 * 4;
                    const neededInRemaining = neededTotal - totalPoints;
                    const neededAverage = neededInRemaining / remaining;
                    
                    let recommendedGrade = 'D-';
                    let minDiff = Math.abs(gradePoints['D-'] - neededAverage);
                    
                    for (const [grade, points] of Object.entries(gradePoints)) {
                        if (grade === 'FA' || grade === 'F' || grade === 'W') continue;
                        const diff = Math.abs(points - neededAverage);
                        if (diff < minDiff && points >= neededAverage) {
                            minDiff = diff;
                            recommendedGrade = grade;
                        }
                    }
                    
                    if (neededAverage <= gradePoints['D-']) {
                        recommendedGrade = 'D-';
                    }
                    
                    const missingCourses = courses.filter(c => !candidacyGrades[c]);
                    
                    return {
                        partial: true,
                        gpa: currentCandidacyGPA.toFixed(3),
                        completed: grades.length,
                        remaining: remaining,
                        neededGrade: recommendedGrade,
                        neededAverage: neededAverage.toFixed(3),
                        missingCourses: missingCourses,
                        message: neededAverage <= gradePoints['D-'] ?
                            `Great job! You've completed ${grades.length} of 4 required courses with a ${currentCandidacyGPA.toFixed(3)} GPA. You can earn as low as a ${recommendedGrade} (${gradePoints[recommendedGrade].toFixed(2)}) in your remaining ${remaining} ${remaining === 1 ? 'course' : 'courses'} and still meet the 2.25 requirement: ${missingCourses.join(', ')}.` :
                            `You've completed ${grades.length} of 4 required courses with a ${currentCandidacyGPA.toFixed(3)} GPA. To reach the 2.25 pre-business course requirement, you need to average at least a ${recommendedGrade} (${gradePoints[recommendedGrade].toFixed(2)}) in your remaining ${remaining} ${remaining === 1 ? 'course' : 'courses'}: ${missingCourses.join(', ')}.`
                    };
                }
            };

            const calculateGoalGrade = () => {
                const current = parseFloat(currentGPA);
                const currentCred = parseFloat(currentCredits);
                const goal = parseFloat(goalGPA);
                const planned = parseFloat(plannedCredits);

                if (!current || !currentCred || !goal || !planned) {
                    return null;
                }

                if (current < 0 || current > 4 || goal < 0 || goal > 4) {
                    return { error: "GPA values must be between 0.0 and 4.0" };
                }

                if (currentCred < 0 || planned < 0) {
                    return { error: "Credit hours cannot be negative" };
                }

                // Check if current GPA already meets or exceeds goal
                if (current >= goal) {
                    return {
                        success: true,
                        message: `Great news! You've already achieved your goal. Your current GPA of ${current.toFixed(3)} meets or exceeds your goal of ${goal.toFixed(3)}.`
                    };
                }

                const currentPoints = current * currentCred;
                const totalCreditsNeeded = currentCred + planned;
                const totalPointsNeeded = goal * totalCreditsNeeded;
                const neededPoints = totalPointsNeeded - currentPoints;
                const requiredGPA = neededPoints / planned;

                const creditHourText = (planned === 1) ? 'hour' : 'hours';

                if (requiredGPA > 4.0) {
                    const maxAchievableGPA = ((currentPoints + (4.0 * planned)) / totalCreditsNeeded).toFixed(3);
                    
                    return { 
                        error: "Goal is not achievable",
                        message: `Even with perfect grades (4.0) in ${planned} credit ${creditHourText}, you can only reach a ${maxAchievableGPA} GPA. Your goal of ${goal.toFixed(3)} is not achievable with ${planned} credit hours.`
                    };
                }

                let closestGrade = 'A';
                let minDiff = Math.abs(4.0 - requiredGPA);
                
                for (const [grade, points] of Object.entries(gradePoints)) {
                    if (points === null) continue;
                    const diff = Math.abs(points - requiredGPA);
                    if (diff < minDiff) {
                        minDiff = diff;
                        closestGrade = grade;
                    }
                }

                return {
                    success: true,
                    requiredGPA: requiredGPA.toFixed(3),
                    closestGrade: closestGrade,
                    gradeValue: gradePoints[closestGrade].toFixed(1),
                    message: `To reach your goal GPA of ${goal.toFixed(3)}, you need to earn an average of ${requiredGPA.toFixed(3)} across ${planned} credit ${creditHourText}. This is approximately a ${closestGrade} (${gradePoints[closestGrade].toFixed(2)}) average.`
                };
            };

            const resetAllData = () => {
                if (window.confirm('Are you sure you want to clear all semesters and start over? This cannot be undone.')) {
                    localStorage.removeItem('mtsuGPAData');
                    initializeFirstSemester();
                }
            };

            const exportToPDF = () => {
                if (!studentName.trim() || !studentMNumber.trim()) {
                    alert('Please enter your name and M# to generate the PDF.');
                    return;
                }
                
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                const pageWidth = doc.internal.pageSize.getWidth();
                const margin = 20;
                let yPos = 20;
                
                // Title
                doc.setFontSize(18);
                doc.setFont(undefined, 'bold');
                doc.text('Jones College of Business GPA Calculator', pageWidth / 2, yPos, { align: 'center' });
                
                yPos += 10;
                doc.setFontSize(12);
                doc.setFont(undefined, 'normal');
                doc.text('Middle Tennessee State University', pageWidth / 2, yPos, { align: 'center' });
                
                yPos += 15;
                doc.setFontSize(10);
                doc.text(`Generated: ${new Date().toLocaleDateString()}`, pageWidth / 2, yPos, { align: 'center' });
                
                // Student Info
                yPos += 12;
                doc.setFontSize(11);
                doc.setFont(undefined, 'bold');
                doc.text(`Student: ${studentName}`, margin, yPos);
                yPos += 7;
                doc.text(`M#: ${studentMNumber}`, margin, yPos);
                
                // Check which calculator is active and generate appropriate content
                if (showCandidacy) {
                    // Jones Candidacy PDF
                    yPos += 15;
                    doc.setFontSize(14);
                    doc.setFont(undefined, 'bold');
                    doc.text('Jones College Candidacy Requirements', margin, yPos);
                    
                    yPos += 10;
                    doc.setFontSize(11);
                    doc.setFont(undefined, 'normal');
                    
                    const courses = ['ECON 2410', 'ECON 2420', 'BIA 2610', 'ACTG 2110'];
                    courses.forEach(course => {
                        const grade = candidacyGrades[course];
                        const gradeText = grade ? `${grade} (${gradePoints[grade].toFixed(2)})` : 'Not Taken Yet';
                        doc.text(`${course}: ${gradeText}`, margin, yPos);
                        yPos += 7;
                    });
                    
                    const result = calculateCandidacyStatus();
                    if (result) {
                        yPos += 10;
                        doc.setFontSize(12);
                        doc.setFont(undefined, 'bold');
                        doc.text(`Pre-Business Course GPA: ${result.gpa}`, margin, yPos);
                        
                        yPos += 10;
                        doc.setFontSize(11);
                        doc.setFont(undefined, 'normal');
                        
                        if (result.success) {
                            doc.setTextColor(0, 128, 0);
                            doc.text('Status: Requirements Met!', margin, yPos);
                        } else if (result.partial) {
                            doc.setTextColor(200, 150, 0);
                            doc.text(`Status: In Progress (${result.completed} of 4 courses)`, margin, yPos);
                            yPos += 7;
                            doc.text(`Target Grade Needed: ${result.neededGrade}`, margin, yPos);
                        } else {
                            doc.setTextColor(200, 0, 0);
                            doc.text('Status: Requirements Not Met', margin, yPos);
                            yPos += 7;
                            doc.text(`Recommended: Repeat ${result.lowestCourse}`, margin, yPos);
                            yPos += 7;
                            doc.text(`Target Grade: ${result.neededGrade}`, margin, yPos);
                        }
                        doc.setTextColor(0, 0, 0);
                    }
                    
                } else if (showGoalPlanner) {
                    // Goal Planner PDF
                    yPos += 15;
                    doc.setFontSize(14);
                    doc.setFont(undefined, 'bold');
                    doc.text('GPA Goal Planner', margin, yPos);
                    
                    yPos += 10;
                    doc.setFontSize(11);
                    doc.setFont(undefined, 'normal');
                    
                    doc.text(`Current GPA: ${currentGPA || 'Not entered'}`, margin, yPos);
                    yPos += 7;
                    doc.text(`Current GPA Hours: ${currentCredits || 'Not entered'}`, margin, yPos);
                    yPos += 7;
                    doc.text(`Goal GPA: ${goalGPA || 'Not entered'}`, margin, yPos);
                    yPos += 7;
                    doc.text(`Planned Credit Hours: ${plannedCredits || 'Not entered'}`, margin, yPos);
                    
                    const result = calculateGoalGrade();
                    if (result) {
                        yPos += 12;
                        doc.setFontSize(12);
                        doc.setFont(undefined, 'bold');
                        doc.text('Results:', margin, yPos);
                        
                        yPos += 8;
                        doc.setFontSize(11);
                        doc.setFont(undefined, 'normal');
                        
                        if (result.error) {
                            doc.setTextColor(200, 0, 0);
                            doc.text(`Error: ${result.error}`, margin, yPos);
                            if (result.message) {
                                yPos += 7;
                                doc.text(result.message, margin, yPos, { maxWidth: pageWidth - 2 * margin });
                            }
                        } else if (result.success) {
                            doc.setTextColor(0, 128, 0);
                            if (result.requiredGPA) {
                                doc.text(`Required GPA: ${result.requiredGPA}`, margin, yPos);
                                yPos += 7;
                                doc.text(`Target Grade Average: ${result.closestGrade} (${result.gradeValue})`, margin, yPos);
                            } else {
                                doc.text('Goal Already Achieved!', margin, yPos);
                            }
                        }
                        doc.setTextColor(0, 0, 0);
                    }
                    
                } else {
                    // GPA Calculator PDF
                    yPos += 15;
                    doc.setFontSize(14);
                    doc.setFont(undefined, 'bold');
                    doc.text('GPA Summary', margin, yPos);
                    
                    yPos += 10;
                    doc.setFontSize(11);
                    doc.setFont(undefined, 'normal');
                    
                    const credits = getTotalCredits();
                    doc.text(`Cumulative GPA: ${calculateCumulativeGPA()}`, margin, yPos);
                    yPos += 7;
                    doc.text(`Credits Earned: ${credits.earned}`, margin, yPos);
                    yPos += 7;
                    doc.text(`Credits Attempted: ${credits.attempted}`, margin, yPos);
                    
                    // Semesters
                    yPos += 15;
                    doc.setFontSize(14);
                    doc.setFont(undefined, 'bold');
                    doc.text('Semester Breakdown', margin, yPos);
                    
                    semesters.forEach((semester, semIndex) => {
                        yPos += 12;
                        
                        // Check if we need a new page
                        if (yPos > 250) {
                            doc.addPage();
                            yPos = 20;
                        }
                        
                        doc.setFontSize(12);
                        doc.setFont(undefined, 'bold');
                        doc.text(`${semester.name} (Semester GPA: ${calculateSemesterGPA(semIndex)})`, margin, yPos);
                        
                        yPos += 8;
                        doc.setFontSize(10);
                        doc.setFont(undefined, 'normal');
                        
                        semester.courses.forEach(course => {
                            if (course.name && course.credits && course.grade) {
                                if (yPos > 270) {
                                    doc.addPage();
                                    yPos = 20;
                                }
                                const gradeText = gradePoints[course.grade] !== null ? 
                                    `${course.grade} (${gradePoints[course.grade].toFixed(2)})` : 
                                    course.grade;
                                doc.text(`  • ${course.name} - ${course.credits} credits - ${gradeText}`, margin + 5, yPos);
                                yPos += 6;
                            }
                        });
                    });
                }
                
                // Footer
                const pageCount = doc.internal.getNumberOfPages();
                for (let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    doc.setFontSize(8);
                    doc.setFont(undefined, 'italic');
                    doc.text(`Page ${i} of ${pageCount}`, pageWidth / 2, 285, { align: 'center' });
                }
                
                const calculatorType = showCandidacy ? 'Candidacy' : showGoalPlanner ? 'GoalPlanner' : 'GPA';
                doc.save(`${studentMNumber}_${calculatorType}_Report.pdf`);
                setShowPDFDialog(false);
            };

            if (semesters.length === 0) {
                return <div className="flex items-center justify-center min-h-screen">Loading...</div>;
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-blue-100 p-6">
                    {showPDFDialog && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-lg shadow-xl max-w-md w-full p-6">
                                <h3 className="text-xl font-bold text-gray-800 mb-4">Export to PDF</h3>
                                <p className="text-gray-700 mb-4">Please enter your information to generate your GPA report.</p>
                                
                                <div className="mb-4">
                                    <label className="block text-sm font-semibold text-gray-700 mb-2">
                                        Student Name
                                    </label>
                                    <input
                                        type="text"
                                        placeholder="e.g., John Smith"
                                        value={studentName}
                                        onChange={(e) => setStudentName(e.target.value)}
                                        className="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    />
                                </div>
                                
                                <div className="mb-6">
                                    <label className="block text-sm font-semibold text-gray-700 mb-2">
                                        M Number
                                    </label>
                                    <input
                                        type="text"
                                        placeholder="e.g., M01234567"
                                        value={studentMNumber}
                                        onChange={(e) => setStudentMNumber(e.target.value)}
                                        className="w-full px-4 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                    />
                                </div>
                                
                                <div className="flex gap-3 justify-end">
                                    <button
                                        onClick={() => setShowPDFDialog(false)}
                                        className="px-6 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition font-semibold"
                                    >
                                        Cancel
                                    </button>
                                    <button
                                        onClick={exportToPDF}
                                        className="px-6 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition font-semibold"
                                    >
                                        Generate PDF
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {duplicateDialog && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-lg shadow-xl max-w-md w-full p-6">
                                <h3 className="text-xl font-bold text-gray-800 mb-4">Repeat Course Detected</h3>
                                <p className="text-gray-700 mb-6">
                                    You've already entered "<strong>{duplicateDialog.duplicateName}</strong>". Are you retaking this course to improve your grade?
                                </p>
                                <div className="flex gap-3 justify-end">
                                    <button
                                        onClick={() => handleDuplicateResponse(false)}
                                        className="px-6 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition font-semibold"
                                    >
                                        No, remove it
                                    </button>
                                    <button
                                        onClick={() => handleDuplicateResponse(true)}
                                        className="px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition font-semibold"
                                    >
                                        Yes, I'm retaking it
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    <div className="max-w-6xl mx-auto">
                        <div className="bg-blue-600 text-white rounded-t-lg p-6 shadow-lg" style={{background: currentColors.header}}>
                            <div className="flex justify-between items-start mb-4">
                                <div className="flex-1">
                                    <h1 className="text-3xl font-bold text-center">Jones College of Business GPA Calculator</h1>
                                    <p className="text-center mt-2" style={{color: currentColors.subtitle}}>Middle Tennessee State University</p>
                                </div>
                                <div className="ml-4">
                                    <label className="block text-sm mb-1 opacity-90">Color Theme</label>
                                    <select
                                        value={colorScheme}
                                        onChange={(e) => setColorScheme(e.target.value)}
                                        className="px-3 py-2 rounded text-gray-800 text-sm font-semibold focus:outline-none focus:ring-2 focus:ring-white"
                                    >
                                        {Object.entries(colorSchemes).map(([key, scheme]) => (
                                            <option key={key} value={key}>{scheme.name}</option>
                                        ))}
                                    </select>
                                </div>
                            </div>
                            
                            <div className="flex flex-wrap justify-center gap-4 mt-4">
                                <button
                                    onClick={() => {
                                        setShowGoalPlanner(false);
                                        setShowCandidacy(false);
                                    }}
                                    className={`px-6 py-2 rounded transition ${
                                        !showGoalPlanner && !showCandidacy
                                            ? 'bg-white font-semibold'
                                            : 'hover:opacity-80'
                                    }`}
                                    style={!showGoalPlanner && !showCandidacy ? {color: '#03045e'} : {backgroundColor: currentColors.navButton1, color: currentColors.buttonText || 'white'}}
                                >
                                    Calculate GPA
                                </button>
                                <button
                                    onClick={() => {
                                        setShowGoalPlanner(true);
                                        setShowCandidacy(false);
                                    }}
                                    className={`px-6 py-2 rounded transition ${
                                        showGoalPlanner && !showCandidacy
                                            ? 'bg-white font-semibold'
                                            : 'hover:opacity-80'
                                    }`}
                                    style={showGoalPlanner && !showCandidacy ? {color: '#03045e'} : {backgroundColor: currentColors.navButton2, color: currentColors.buttonText || 'white'}}
                                >
                                    Goal Planner
                                </button>
                                <button
                                    onClick={() => {
                                        setShowGoalPlanner(false);
                                        setShowCandidacy(true);
                                    }}
                                    className={`px-6 py-2 rounded transition ${
                                        showCandidacy
                                            ? 'bg-white font-semibold'
                                            : 'hover:opacity-80'
                                    }`}
                                    style={showCandidacy ? {color: '#03045e'} : {backgroundColor: currentColors.navButton3, color: currentColors.buttonText || 'white'}}
                                >
                                    Jones Candidacy
                                </button>
                            </div>
                        </div>

                        <div className="bg-white rounded-b-lg shadow-lg p-6">
                            {showCandidacy ? (
                                <>
                                    <div className="bg-blue-50 border-l-4 border-blue-600 p-4 mb-6 rounded">
                                        <h3 className="font-bold text-blue-900 mb-2">Jones College of Business - Pre-Business Course Requirement</h3>
                                        <p className="text-gray-700 mb-2">
                                            To be admitted to Jones College of Business (BBA programs), you need a <strong>2.25 GPA average</strong> across these four pre-business courses: ECON 2410, ECON 2420, BIA 2610, and ACTG 2110.
                                        </p>
                                        <p className="text-sm text-gray-600 italic">
                                            Note: You also need 30+ semester hours completed, an inclusive GPA ≥ 2.25, and to complete the Jones College Admission Application. This calculator focuses on the 4 pre-business course GPA requirement.
                                        </p>
                                    </div>

                                    <div className="grid md:grid-cols-2 gap-6 mb-6">
                                        {['ECON 2410', 'ECON 2420', 'BIA 2610', 'ACTG 2110'].map(course => (
                                            <div key={course}>
                                                <label className="block text-sm font-semibold text-gray-700 mb-2">
                                                    {course}
                                                </label>
                                                <select
                                                    value={candidacyGrades[course]}
                                                    onChange={(e) => setCandidacyGrades({
                                                        ...candidacyGrades,
                                                        [course]: e.target.value
                                                    })}
                                                    className="w-full px-4 py-3 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                >
                                                    <option value="">Not Taken Yet</option>
                                                    {Object.keys(gradePoints).filter(g => g !== 'FA' && g !== 'W').map(grade => (
                                                        <option key={grade} value={grade}>
                                                            {grade} ({gradePoints[grade].toFixed(2)})
                                                        </option>
                                                    ))}
                                                </select>
                                            </div>
                                        ))}
                                    </div>

                                    {(() => {
                                        const result = calculateCandidacyStatus();
                                        
                                        if (!result) {
                                            return (
                                                <div className="bg-gray-50 border-l-4 border-gray-400 p-6 rounded">
                                                    <p className="text-gray-600">Enter your grades above to see your candidacy status.</p>
                                                </div>
                                            );
                                        }
                                        
                                        if (result.success) {
                                            return (
                                                <div className="bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg p-6">
                                                    <h3 className="text-2xl font-bold mb-4 text-center">✓ Pre-Business Course Requirement Met!</h3>
                                                    <p className="text-lg leading-relaxed">{result.message}</p>
                                                    <div className="mt-6 bg-white/20 rounded p-4 text-center">
                                                        <p className="text-sm text-green-100">Your Pre-Business Course GPA</p>
                                                        <p className="text-4xl font-bold">{result.gpa}</p>
                                                    </div>
                                                </div>
                                            );
                                        }
                                        
                                        if (result.partial) {
                                            return (
                                                <div className="bg-gradient-to-r from-yellow-500 to-yellow-600 rounded-lg p-6" style={{color: '#374151'}}>
                                                    <h3 className="text-2xl font-bold mb-4 text-center">In Progress</h3>
                                                    <p className="text-lg leading-relaxed mb-4">{result.message}</p>
                                                    <div className="grid md:grid-cols-2 gap-4 mt-6">
                                                        <div className="bg-white/20 rounded p-4 text-center">
                                                            <p className="text-sm mb-1" style={{color: '#374151'}}>Current GPA</p>
                                                            <p className="text-3xl font-bold">{result.gpa}</p>
                                                            <p className="text-xs mt-1" style={{color: '#374151'}}>{result.completed} of 4 courses</p>
                                                        </div>
                                                        <div className="bg-white/20 rounded p-4 text-center">
                                                            <p className="text-sm mb-1" style={{color: '#374151'}}>Target Grade Needed</p>
                                                            <p className="text-3xl font-bold">{result.neededGrade}</p>
                                                            <p className="text-xs mt-1" style={{color: '#374151'}}>Average in remaining courses</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            );
                                        }
                                        
                                        if (!result.success) {
                                            return (
                                                <div className="bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg p-6">
                                                    <h3 className="text-2xl font-bold mb-4 text-center">Pre-Business Course Requirement Not Met</h3>
                                                    <p className="text-lg leading-relaxed mb-4">{result.message}</p>
                                                    <div className="grid md:grid-cols-3 gap-4 mt-6">
                                                        <div className="bg-white/20 rounded p-4 text-center">
                                                            <p className="text-sm text-red-100">Current GPA</p>
                                                            <p className="text-3xl font-bold">{result.gpa}</p>
                                                        </div>
                                                        <div className="bg-white/20 rounded p-4 text-center">
                                                            <p className="text-sm text-red-100">Course to Repeat</p>
                                                            <p className="text-xl font-bold">{result.lowestCourse}</p>
                                                            <p className="text-xs text-red-100 mt-1">Current: {result.currentGrade}</p>
                                                        </div>
                                                        <div className="bg-white/20 rounded p-4 text-center">
                                                            <p className="text-sm text-red-100">Grade Needed</p>
                                                            <p className="text-3xl font-bold">{result.neededGrade}</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            );
                                        }
                                        
                                        return null;
                                    })()}

                                    <div className="mt-6">
                                        <button
                                            onClick={() => setCandidacyGrades({
                                                'ECON 2410': '',
                                                'ECON 2420': '',
                                                'BIA 2610': '',
                                                'ACTG 2110': ''
                                            })}
                                            className="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition"
                                        >
                                            Reset Candidacy Calculator
                                        </button>
                                        <button
                                            onClick={() => setShowPDFDialog(true)}
                                            className="ml-3 flex-inline items-center gap-2 px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition"
                                        >
                                            Export to PDF
                                        </button>
                                    </div>
                                </>
                            ) : !showGoalPlanner ? (
                                <>
                                    <div className="mb-6">
                                        <div className="flex flex-wrap gap-2 mb-4 items-center">
                                            {semesters.map((semester, index) => (
                                                <div key={semester.id} className="flex items-center gap-1 bg-gray-50 rounded-lg p-1">
                                                    <button
                                                        onClick={() => setActiveSemester(index)}
                                                        className={`px-4 py-2 rounded transition ${
                                                            activeSemester === index
                                                                ? 'text-white font-semibold shadow-md'
                                                                : 'bg-white text-gray-700 hover:bg-gray-100 border border-gray-300'
                                                        }`}
                                                        style={activeSemester === index ? {backgroundColor: currentColors.activeTab} : {}}
                                                    >
                                                        {semester.name}
                                                    </button>
                                                    <button
                                                        onClick={(e) => {
                                                            e.stopPropagation();
                                                            const newName = prompt('Enter semester name:', semester.name);
                                                            if (newName && newName.trim()) {
                                                                updateSemesterName(index, newName.trim());
                                                            }
                                                        }}
                                                        className="text-gray-500 hover:text-blue-600 p-1"
                                                        title="Edit semester name"
                                                    >
                                                        ✏️
                                                    </button>
                                                    {semesters.length > 1 && (
                                                        <button
                                                            onClick={(e) => {
                                                                e.stopPropagation();
                                                                if (window.confirm(`Delete "${semester.name}"?`)) {
                                                                    removeSemester(index);
                                                                }
                                                            }}
                                                            className="text-red-500 hover:text-red-700 p-1"
                                                            title="Delete semester"
                                                        >
                                                            <Trash2 size={16} />
                                                        </button>
                                                    )}
                                                </div>
                                            ))}
                                            <button
                                                onClick={addSemester}
                                                className="px-4 py-2 text-white rounded-lg hover:opacity-90 transition flex items-center gap-2 shadow-md"
                                                style={{backgroundColor: currentColors.addButton, color: currentColors.buttonText || 'white'}}
                                            >
                                                <PlusCircle size={18} />
                                                Add Semester
                                            </button>
                                        </div>
                                    </div>

                                    <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                                        <div className="text-white rounded-lg p-4 text-center" style={{background: currentColors.card1, color: currentColors.cardText || 'white'}}>
                                            <p className="text-sm mb-1">Cumulative GPA</p>
                                            <p className="text-3xl font-bold">{calculateCumulativeGPA()}</p>
                                        </div>
                                        <div className="text-white rounded-lg p-4 text-center" style={{background: currentColors.card2, color: currentColors.cardText || 'white'}}>
                                            <p className="text-sm mb-1">Semester GPA</p>
                                            <p className="text-3xl font-bold">{calculateSemesterGPA(activeSemester)}</p>
                                        </div>
                                        <div className="text-white rounded-lg p-4 text-center" style={{background: currentColors.card3, color: currentColors.cardText || 'white'}}>
                                            <p className="text-sm mb-1">Credits Earned</p>
                                            <p className="text-3xl font-bold">{getTotalCredits().earned}</p>
                                        </div>
                                        <div className="text-white rounded-lg p-4 text-center" style={{background: currentColors.card4, color: currentColors.cardText || 'white'}}>
                                            <p className="text-sm mb-1">Credits Attempted</p>
                                            <p className="text-3xl font-bold">{getTotalCredits().attempted}</p>
                                        </div>
                                    </div>

                                    <div className="bg-blue-50 border-l-4 border-blue-600 p-4 mb-6 rounded">
                                        <p className="text-gray-700">
                                            Viewing: <strong>{semesters[activeSemester].name}</strong>. Add courses below and your GPA will calculate automatically. Data is saved automatically to your browser.
                                        </p>
                                    </div>

                                    <div className="overflow-x-auto">
                                        <table className="w-full mb-6">
                                            <thead>
                                                <tr className="bg-gray-100">
                                                    <th className="p-3 text-left font-semibold text-gray-700">Course Name</th>
                                                    <th className="p-3 text-left font-semibold text-gray-700">Credit Hours</th>
                                                    <th className="p-3 text-left font-semibold text-gray-700">Grade</th>
                                                    <th className="p-3 text-center font-semibold text-gray-700">Action</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {semesters[activeSemester].courses.map((course, index) => (
                                                    <tr key={course.id} className={index % 2 === 0 ? 'bg-white' : 'bg-gray-50'}>
                                                        <td className="p-3">
                                                            <input
                                                                type="text"
                                                                placeholder="e.g., MATH 1910"
                                                                value={course.name}
                                                                onChange={(e) => updateCourse(activeSemester, course.id, 'name', e.target.value)}
                                                                onBlur={(e) => {
                                                                    if (e.target.value.trim() !== '') {
                                                                        checkForDuplicate(activeSemester, course.id, e.target.value.trim());
                                                                    }
                                                                }}
                                                                className="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                            />
                                                        </td>
                                                        <td className="p-3">
                                                            <input
                                                                type="number"
                                                                placeholder="3"
                                                                min="0"
                                                                max="6"
                                                                step="0.5"
                                                                value={course.credits}
                                                                onChange={(e) => updateCourse(activeSemester, course.id, 'credits', e.target.value)}
                                                                onKeyPress={(e) => {
                                                                    if (!/[0-9.]/.test(e.key)) {
                                                                        e.preventDefault();
                                                                    }
                                                                }}
                                                                className="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                            />
                                                        </td>
                                                        <td className="p-3">
                                                            <select
                                                                value={course.grade}
                                                                onChange={(e) => updateCourse(activeSemester, course.id, 'grade', e.target.value)}
                                                                className="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                            >
                                                                <option value="">Select Grade</option>
                                                                {Object.keys(gradePoints).map(grade => (
                                                                    <option key={grade} value={grade}>
                                                                        {grade} {gradePoints[grade] !== null ? `(${gradePoints[grade].toFixed(2)})` : ''}
                                                                    </option>
                                                                ))}
                                                            </select>
                                                        </td>
                                                        <td className="p-3 text-center">
                                                            <button
                                                                onClick={() => removeCourse(activeSemester, course.id)}
                                                                disabled={semesters[activeSemester].courses.length === 1}
                                                                className={`p-2 rounded ${
                                                                    semesters[activeSemester].courses.length === 1
                                                                        ? 'text-gray-300 cursor-not-allowed'
                                                                        : 'text-red-600 hover:bg-red-50'
                                                                }`}
                                                            >
                                                                <Trash2 size={20} />
                                                            </button>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>

                                    <div className="flex flex-wrap gap-4 mb-6">
                                        <button
                                            onClick={() => addCourse(activeSemester)}
                                            className="flex items-center gap-2 px-4 py-2 text-white rounded hover:opacity-90 transition"
                                            style={{backgroundColor: currentColors.actionButton, color: currentColors.buttonText || 'white'}}
                                        >
                                            <PlusCircle size={20} />
                                            Add Course
                                        </button>
                                        <button
                                            onClick={() => setShowPDFDialog(true)}
                                            className="flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition"
                                        >
                                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                                <polyline points="7 10 12 15 17 10"></polyline>
                                                <line x1="12" y1="15" x2="12" y2="3"></line>
                                            </svg>
                                            Export to PDF
                                        </button>
                                        <button
                                            onClick={resetAllData}
                                            className="px-4 py-2 text-white rounded hover:opacity-90 transition"
                                            style={{backgroundColor: currentColors.infoBox, color: currentColors.buttonText || 'white'}}
                                        >
                                            Reset All
                                        </button>
                                    </div>
                                </>
                            ) : (
                                <>
                                    <div className="bg-blue-50 border-l-4 border-blue-600 p-4 mb-6 rounded">
                                        <p className="text-gray-700 mb-3">
                                            Enter your current GPA and credit hours, then specify your goal GPA and how many credit hours you plan to take. We'll calculate what grades you need to achieve your goal.
                                        </p>
                                        <div className="bg-white rounded p-3">
                                            <p className="font-semibold text-blue-900 mb-2">📍 Where to Find Your Information:</p>
                                            <div className="text-sm text-gray-700">
                                                <p className="mb-2">Go to: <strong>PipelineMT → Registration & Student Records → GPAs</strong> (under Academic Records)</p>
                                                <p className="mb-1"><strong>Use your Inclusive GPA and GPA Hours</strong></p>
                                                <p className="text-xs text-gray-600 italic">(Inclusive GPA is used for Jones College candidacy and program admissions)</p>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="grid md:grid-cols-2 gap-6 mb-6">
                                        <div>
                                            <label className="block text-sm font-semibold text-gray-700 mb-2">
                                                Current GPA
                                            </label>
                                            <input
                                                type="number"
                                                placeholder="e.g., 3.25"
                                                min="0"
                                                max="4"
                                                step="0.0001"
                                                value={currentGPA}
                                                onChange={(e) => {
                                                    const val = e.target.value;
                                                    const numVal = parseFloat(val);
                                                    if (val === '' || (numVal >= 0 && numVal <= 4)) {
                                                        setCurrentGPA(val);
                                                    }
                                                }}
                                                onBlur={(e) => {
                                                    const val = parseFloat(e.target.value);
                                                    if (!isNaN(val)) {
                                                        setCurrentGPA(val.toFixed(4).replace(/\.?0+$/, ''));
                                                    }
                                                }}
                                                onKeyPress={(e) => {
                                                    if (!/[0-9.]/.test(e.key)) {
                                                        e.preventDefault();
                                                    }
                                                }}
                                                className="w-full px-4 py-3 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-semibold text-gray-700 mb-2">
                                                Current GPA Hours
                                            </label>
                                            <input
                                                type="number"
                                                placeholder="e.g., 45"
                                                min="0"
                                                step="0.5"
                                                value={currentCredits}
                                                onChange={(e) => setCurrentCredits(e.target.value)}
                                                className="w-full px-4 py-3 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            />
                                            <p className="text-xs text-gray-500 mt-1">Use the GPA Hours shown next to your Inclusive GPA</p>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-semibold text-gray-700 mb-2">
                                                Goal GPA
                                            </label>
                                            <input
                                                type="number"
                                                placeholder="e.g., 3.50"
                                                min="0"
                                                max="4"
                                                step="0.0001"
                                                value={goalGPA}
                                                onChange={(e) => {
                                                    const val = e.target.value;
                                                    const numVal = parseFloat(val);
                                                    if (val === '' || (numVal >= 0 && numVal <= 4 && /^\d*\.?\d{0,4}$/.test(val))) {
                                                        setGoalGPA(val);
                                                    }
                                                }}
                                                onKeyPress={(e) => {
                                                    if (!/[0-9.]/.test(e.key)) {
                                                        e.preventDefault();
                                                    }
                                                }}
                                                className="w-full px-4 py-3 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-semibold text-gray-700 mb-2">
                                                Planned Credit Hours
                                            </label>
                                            <input
                                                type="number"
                                                placeholder="e.g., 15"
                                                min="0"
                                                step="0.5"
                                                value={plannedCredits}
                                                onChange={(e) => setPlannedCredits(e.target.value)}
                                                className="w-full px-4 py-3 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            />
                                        </div>
                                    </div>

                                    {currentGPA && currentCredits && goalGPA && plannedCredits && (() => {
                                        const result = calculateGoalGrade();
                                        
                                        if (result?.error) {
                                            return (
                                                <div className="bg-red-50 border-l-4 border-red-500 p-6 rounded">
                                                    <h3 className="text-lg font-semibold text-red-800 mb-2">{result.error}</h3>
                                                    {result.message && (
                                                        <p className="text-red-700">{result.message}</p>
                                                    )}
                                                </div>
                                            );
                                        }
                                        
                                        if (result?.success) {
                                            return (
                                                <div className="bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg p-6">
                                                    <h3 className="text-2xl font-bold mb-4 text-center">Your Goal Plan</h3>
                                                    <p className="text-lg leading-relaxed">{result.message}</p>
                                                    
                                                    {result.requiredGPA && (
                                                        <div className="mt-6 bg-white/20 rounded p-4">
                                                            <div className="grid md:grid-cols-2 gap-4 text-center">
                                                                <div>
                                                                    <p className="text-sm text-green-100">Required GPA</p>
                                                                    <p className="text-3xl font-bold">{result.requiredGPA}</p>
                                                                </div>
                                                                <div>
                                                                    <p className="text-sm text-green-100">Target Grade Average</p>
                                                                    <p className="text-3xl font-bold">{result.closestGrade}</p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    )}
                                                </div>
                                            );
                                        }
                                        
                                        return null;
                                    })()}
                                    
                                    <div className="mt-6">
                                        <button
                                            onClick={() => {
                                                setCurrentGPA('');
                                                setCurrentCredits('');
                                                setGoalGPA('');
                                                setPlannedCredits('');
                                            }}
                                            className="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition"
                                        >
                                            Reset Goal Planner
                                        </button>
                                        <button
                                            onClick={() => setShowPDFDialog(true)}
                                            className="ml-3 flex-inline items-center gap-2 px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition"
                                        >
                                            Export to PDF
                                        </button>
                                    </div>
                                </>
                            )}

                            <div className="mt-6 p-6 bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg border-2 border-blue-200 shadow-md">
                                <h3 className="text-lg font-bold text-blue-900 mb-4 flex items-center gap-2">
                                    <span className="text-2xl">📊</span>
                                    MTSU Grade Scale
                                </h3>
                                <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-6">
                                    {Object.entries(gradePoints).filter(([grade]) => grade !== 'W').map(([grade, points]) => (
                                        <div key={grade} className="bg-white rounded-lg p-3 shadow-sm border border-blue-100 hover:shadow-md transition">
                                            <div className="flex justify-between items-center">
                                                <span className="font-bold text-blue-700 text-lg">{grade}</span>
                                                <span className="text-gray-700 font-semibold">{points.toFixed(2)}</span>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                <div className="bg-white rounded-lg p-4 border border-blue-200">
                                    <h4 className="font-semibold text-blue-800 mb-2">Grades That Do Not Affect GPA:</h4>
                                    <div className="grid md:grid-cols-2 gap-2 text-sm text-gray-700">
                                        <div><span className="font-semibold">I</span> - Incomplete</div>
                                        <div><span className="font-semibold">P</span> - Pass (Pass/Fail)</div>
                                        <div><span className="font-semibold">NC</span> - No Credit (Audit)</div>
                                        <div><span className="font-semibold">W</span> - Withdrawal</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<MTSUGPACalculator />, document.getElementById('root'));
    </script>
</body>
</html>