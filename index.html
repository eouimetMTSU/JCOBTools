<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MTSU GPA Calculator</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const PlusCircle = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="16"></line>
                <line x1="8" y1="12" x2="16" y2="12"></line>
            </svg>
        );

        const Trash2 = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
        );

        function MTSUGPACalculator() {
            const [semesters, setSemesters] = useState([]);
            const [showGoalPlanner, setShowGoalPlanner] = useState(false);
            const [showCandidacy, setShowCandidacy] = useState(false);
            const [currentGPA, setCurrentGPA] = useState('');
            const [currentCredits, setCurrentCredits] = useState('');
            const [goalGPA, setGoalGPA] = useState('');
            const [plannedCredits, setPlannedCredits] = useState('');
            const [duplicateDialog, setDuplicateDialog] = useState(null);
            const [activeSemester, setActiveSemester] = useState(0);
            
            const [candidacyGrades, setCandidacyGrades] = useState({
                'ECON 2410': '',
                'ECON 2420': '',
                'BIA 2610': '',
                'ACTG 2110': ''
            });

            const gradePoints = {
                'A': 4.0,
                'B+': 3.33,
                'B': 3.0,
                'B-': 2.67,
                'C+': 2.33,
                'C': 2.0,
                'C-': 1.67,
                'D+': 1.33,
                'D': 1.0,
                'D-': 0.67,
                'F': 0.0,
                'FA': 0.0,
                'W': null
            };

            useEffect(() => {
                const savedData = localStorage.getItem('mtsuGPAData');
                if (savedData) {
                    try {
                        const parsed = JSON.parse(savedData);
                        setSemesters(parsed.semesters || []);
                        setActiveSemester(parsed.activeSemester || 0);
                    } catch (e) {
                        initializeFirstSemester();
                    }
                } else {
                    initializeFirstSemester();
                }
            }, []);

            useEffect(() => {
                if (semesters.length > 0) {
                    localStorage.setItem('mtsuGPAData', JSON.stringify({
                        semesters,
                        activeSemester
                    }));
                }
            }, [semesters, activeSemester]);

            const initializeFirstSemester = () => {
                setSemesters([{
                    id: Date.now(),
                    name: 'Fall 2025',
                    courses: [{ id: 1, name: '', credits: '', grade: '' }]
                }]);
                setActiveSemester(0);
            };

            const addSemester = () => {
                let newSemesterName = 'Fall 2025';
                
                if (semesters.length > 0) {
                    const lastSemester = semesters[semesters.length - 1].name.toLowerCase();
                    const yearMatch = lastSemester.match(/\d{4}/);
                    const currentYear = yearMatch ? parseInt(yearMatch[0]) : new Date().getFullYear();
                    
                    if (lastSemester.includes('fall')) {
                        newSemesterName = `Spring ${currentYear + 1}`;
                    } else if (lastSemester.includes('spring')) {
                        newSemesterName = `Summer ${currentYear}`;
                    } else if (lastSemester.includes('summer')) {
                        newSemesterName = `Fall ${currentYear}`;
                    } else {
                        newSemesterName = `Semester ${semesters.length + 1}`;
                    }
                }
                
                const newSemester = {
                    id: Date.now(),
                    name: newSemesterName,
                    courses: [{ id: Date.now(), name: '', credits: '', grade: '' }]
                };
                setSemesters([...semesters, newSemester]);
                setActiveSemester(semesters.length);
            };

            const removeSemester = (index) => {
                if (semesters.length > 1) {
                    const newSemesters = semesters.filter((_, i) => i !== index);
                    setSemesters(newSemesters);
                    if (activeSemester >= newSemesters.length) {
                        setActiveSemester(newSemesters.length - 1);
                    }
                }
            };

            const updateSemesterName = (index, newName) => {
                const newSemesters = [...semesters];
                newSemesters[index].name = newName;
                setSemesters(newSemesters);
            };

            const addCourse = (semesterIndex) => {
                const newSemesters = [...semesters];
                newSemesters[semesterIndex].courses.push({
                    id: Date.now(),
                    name: '',
                    credits: '',
                    grade: ''
                });
                setSemesters(newSemesters);
            };

            const removeCourse = (semesterIndex, courseId) => {
                const newSemesters = [...semesters];
                if (newSemesters[semesterIndex].courses.length > 1) {
                    newSemesters[semesterIndex].courses = newSemesters[semesterIndex].courses.filter(
                        course => course.id !== courseId
                    );
                    setSemesters(newSemesters);
                }
            };

            const updateCourse = (semesterIndex, courseId, field, value) => {
                const newSemesters = [...semesters];
                newSemesters[semesterIndex].courses = newSemesters[semesterIndex].courses.map(course =>
                    course.id === courseId ? { ...course, [field]: value } : course
                );
                setSemesters(newSemesters);
            };

            const checkForDuplicate = (semesterIndex, courseId, courseName) => {
                const normalizedValue = courseName.replace(/\s*\(R\)\s*$/i, '').trim().toLowerCase();
                
                if (normalizedValue === '') return;
                
                let duplicate = null;
                let duplicateSemesterIndex = -1;
                
                for (let i = 0; i < semesters.length; i++) {
                    const found = semesters[i].courses.find(c =>
                        c.id !== courseId &&
                        c.name.replace(/\s*\(R\)\s*$/i, '').trim().toLowerCase() === normalizedValue
                    );
                    if (found) {
                        duplicate = found;
                        duplicateSemesterIndex = i;
                        break;
                    }
                }

                if (duplicate) {
                    setDuplicateDialog({
                        semesterIndex,
                        courseId,
                        courseName: normalizedValue,
                        duplicateSemesterIndex,
                        duplicateId: duplicate.id,
                        duplicateName: duplicate.name.replace(/\s*\(R\)\s*$/i, '')
                    });
                }
            };

            const handleDuplicateResponse = (isRepeated) => {
                const { semesterIndex, courseId, courseName } = duplicateDialog;
                
                if (!isRepeated) {
                    removeCourse(semesterIndex, courseId);
                } else {
                    const newSemesters = [...semesters];
                    const baseName = courseName.replace(/\s*\(R\)\s*$/i, '').trim();
                    
                    // Mark all instances of this course with (R)
                    for (let i = 0; i < newSemesters.length; i++) {
                        newSemesters[i].courses = newSemesters[i].courses.map(course => {
                            const courseBaseName = course.name.replace(/\s*\(R\)\s*$/i, '').trim();
                            if (courseBaseName.toLowerCase() === baseName.toLowerCase()) {
                                return { ...course, name: courseBaseName + ' (R)', isRepeated: true };
                            }
                            return course;
                        });
                    }
                    
                    setSemesters(newSemesters);
                }
                
                setDuplicateDialog(null);
            };

            const calculateSemesterGPA = (semesterIndex) => {
                let totalPoints = 0;
                let totalCredits = 0;

                const courseGroups = {};
                
                semesters[semesterIndex].courses.forEach(course => {
                    const credits = parseFloat(course.credits);
                    const grade = course.grade;
                    
                    if (credits && grade && gradePoints[grade] !== undefined && gradePoints[grade] !== null) {
                        const baseName = course.name.replace(/\s*\(R\)\s*$/i, '').trim().toLowerCase();
                        
                        if (!courseGroups[baseName]) {
                            courseGroups[baseName] = [];
                        }
                        
                        courseGroups[baseName].push({
                            credits: credits,
                            gradePoints: gradePoints[grade],
                            courseIndex: semesters[semesterIndex].courses.indexOf(course)
                        });
                    }
                });

                // For semester GPA, if there are duplicates in the same semester, use the last one entered
                Object.values(courseGroups).forEach(group => {
                    if (group.length === 1) {
                        totalPoints += group[0].credits * group[0].gradePoints;
                        totalCredits += group[0].credits;
                    } else {
                        // Use the last one (highest courseIndex)
                        const lastEntry = group.reduce((latest, current) =>
                            current.courseIndex > latest.courseIndex ? current : latest
                        );
                        totalPoints += lastEntry.credits * lastEntry.gradePoints;
                        totalCredits += lastEntry.credits;
                    }
                });

                return totalCredits > 0 ? (totalPoints / totalCredits).toFixed(3) : '0.000';
            };

            const calculateCumulativeGPA = () => {
                let totalPoints = 0;
                let totalCredits = 0;

                const courseGroups = {};
                
                semesters.forEach((semester, semIndex) => {
                    semester.courses.forEach((course, courseIndex) => {
                        const credits = parseFloat(course.credits);
                        const grade = course.grade;
                        
                        if (credits && grade && gradePoints[grade] !== undefined && gradePoints[grade] !== null) {
                            const baseName = course.name.replace(/\s*\(R\)\s*$/i, '').trim().toLowerCase();
                            
                            if (!courseGroups[baseName]) {
                                courseGroups[baseName] = [];
                            }
                            
                            courseGroups[baseName].push({
                                credits: credits,
                                grade: grade,
                                gradePoints: gradePoints[grade],
                                semesterIndex: semIndex,
                                courseIndex: courseIndex,
                                isRepeated: course.name.match(/\(R\)\s*$/i) !== null
                            });
                        }
                    });
                });

                Object.values(courseGroups).forEach(group => {
                    if (group.length === 1) {
                        totalPoints += group[0].credits * group[0].gradePoints;
                        totalCredits += group[0].credits;
                    } else if (group.length === 2 || group.length === 3) {
                        // Find the most recent one (latest semester, or if same semester, latest courseIndex)
                        const mostRecent = group.reduce((latest, current) => {
                            if (current.semesterIndex > latest.semesterIndex) {
                                return current;
                            } else if (current.semesterIndex === latest.semesterIndex && current.courseIndex > latest.courseIndex) {
                                return current;
                            }
                            return latest;
                        });
                        totalPoints += mostRecent.credits * mostRecent.gradePoints;
                        totalCredits += mostRecent.credits;
                    } else {
                        group.forEach(attempt => {
                            totalPoints += attempt.credits * attempt.gradePoints;
                            totalCredits += attempt.credits;
                        });
                    }
                });

                return totalCredits > 0 ? (totalPoints / totalCredits).toFixed(3) : '0.000';
            };

            const getTotalCredits = () => {
                let earned = 0;
                let attempted = 0;
                
                semesters.forEach(semester => {
                    semester.courses.forEach(course => {
                        const credits = parseFloat(course.credits);
                        const grade = course.grade;
                        if (credits) {
                            attempted += credits;
                            if (grade && grade !== 'F' && grade !== 'FA' && grade !== 'W') {
                                earned += credits;
                            }
                        }
                    });
                });
                
                return { earned: earned.toFixed(1), attempted: attempted.toFixed(1) };
            };

            const calculateCandidacyStatus = () => {
                const courses = ['ECON 2410', 'ECON 2420', 'BIA 2610', 'ACTG 2110'];
                const grades = courses.map(course => candidacyGrades[course]).filter(g => g !== '');
                
                if (grades.length === 0) return null;
                
                let totalPoints = 0;
                grades.forEach(grade => {
                    if (gradePoints[grade] !== undefined && gradePoints[grade] !== null) {
                        totalPoints += gradePoints[grade];
                    }
                });
                const currentCandidacyGPA = grades.length > 0 ? totalPoints / grades.length : 0;
                
                if (grades.length === 4) {
                    if (currentCandidacyGPA >= 2.25) {
                        return {
                            success: true,
                            gpa: currentCandidacyGPA.toFixed(3),
                            message: `Congratulations! Your pre-business course GPA is ${currentCandidacyGPA.toFixed(3)}, which meets the 2.25 requirement. Make sure you've also completed 30+ semester hours and have an inclusive GPA ≥ 2.25, then complete your Jones College Admission Application.`
                        };
                    } else {
                        const courseGrades = courses.map(course => ({
                            course,
                            grade: candidacyGrades[course],
                            points: gradePoints[candidacyGrades[course]]
                        }));
                        
                        courseGrades.sort((a, b) => a.points - b.points);
                        const lowestCourse = courseGrades[0];
                        
                        const otherThreeTotal = courseGrades.slice(1).reduce((sum, cg) => sum + cg.points, 0);
                        const neededPoints = (2.25 * 4) - otherThreeTotal;
                        
                        let recommendedGrade = 'D-';
                        let minDiff = Math.abs(gradePoints['D-'] - neededPoints);
                        
                        for (const [grade, points] of Object.entries(gradePoints)) {
                            if (grade === 'FA' || grade === 'F' || grade === 'W') continue;
                            const diff = Math.abs(points - neededPoints);
                            if (diff < minDiff && points >= neededPoints) {
                                minDiff = diff;
                                recommendedGrade = grade;
                            }
                        }
                        
                        return {
                            success: false,
                            gpa: currentCandidacyGPA.toFixed(3),
                            lowestCourse: lowestCourse.course,
                            currentGrade: lowestCourse.grade,
                            neededGrade: recommendedGrade,
                            message: `Your current candidacy GPA is ${currentCandidacyGPA.toFixed(3)}, which is below the 2.25 requirement. We recommend repeating ${lowestCourse.course} (current grade: ${lowestCourse.grade}). You would need to earn at least a ${recommendedGrade} (${gradePoints[recommendedGrade].toFixed(2)}) to reach the 2.25 pre-business course GPA requirement.`
                        };
                    }
                } else {
                    const remaining = 4 - grades.length;
                    const neededTotal = 2.25 * 4;
                    const neededInRemaining = neededTotal - totalPoints;
                    const neededAverage = neededInRemaining / remaining;
                    
                    let recommendedGrade = 'D-';
                    let minDiff = Math.abs(gradePoints['D-'] - neededAverage);
                    
                    for (const [grade, points] of Object.entries(gradePoints)) {
                        if (grade === 'FA' || grade === 'F' || grade === 'W') continue;
                        const diff = Math.abs(points - neededAverage);
                        if (diff < minDiff && points >= neededAverage) {
                            minDiff = diff;
                            recommendedGrade = grade;
                        }
                    }
                    
                    if (neededAverage <= gradePoints['D-']) {
                        recommendedGrade = 'D-';
                    }
                    
                    const missingCourses = courses.filter(c => !candidacyGrades[c]);
                    
                    return {
                        partial: true,
                        gpa: currentCandidacyGPA.toFixed(3),
                        completed: grades.length,
                        remaining: remaining,
                        neededGrade: recommendedGrade,
                        neededAverage: neededAverage.toFixed(3),
                        missingCourses: missingCourses,
                        message: neededAverage <= gradePoints['D-'] ?
                            `Great job! You've completed ${grades.length} of 4 required courses with a ${currentCandidacyGPA.toFixed(3)} GPA. You can earn as low as a ${recommendedGrade} (${gradePoints[recommendedGrade].toFixed(2)}) in your remaining ${remaining} ${remaining === 1 ? 'course' : 'courses'} and still meet the 2.25 requirement: ${missingCourses.join(', ')}.` :
                            `You've completed ${grades.length} of 4 required courses with a ${currentCandidacyGPA.toFixed(3)} GPA. To reach the 2.25 pre-business course requirement, you need to average at least a ${recommendedGrade} (${gradePoints[recommendedGrade].toFixed(2)}) in your remaining ${remaining} ${remaining === 1 ? 'course' : 'courses'}: ${missingCourses.join(', ')}.`
                    };
                }
            };

            const calculateGoalGrade = () => {
                const current = parseFloat(currentGPA);
                const currentCred = parseFloat(currentCredits);
                const goal = parseFloat(goalGPA);
                const planned = parseFloat(plannedCredits);

                if (!current || !currentCred || !goal || !planned) {
                    return null;
                }

                if (current < 0 || current > 4 || goal < 0 || goal > 4) {
                    return { error: "GPA values must be between 0.0 and 4.0" };
                }

                if (currentCred < 0 || planned < 0) {
                    return { error: "Credit hours cannot be negative" };
                }

                const currentPoints = current * currentCred;
                const totalCreditsNeeded = currentCred + planned;
                const totalPointsNeeded = goal * totalCreditsNeeded;
                const neededPoints = totalPointsNeeded - currentPoints;
                const requiredGPA = neededPoints / planned;

                const creditHourText = (planned === 1) ? 'hour' : 'hours';

                if (requiredGPA > 4.0) {
                    const maxAchievableGPA = ((currentPoints + (4.0 * planned)) / totalCreditsNeeded).toFixed(3);
                    
                    if (parseFloat(maxAchievableGPA) >= goal) {
                        return {
                            success: true,
                            message: `Great news! You've already achieved or can reach your goal GPA of ${goal.toFixed(3)}. With perfect grades (4.0) in your next ${planned} credit ${creditHourText}, you can reach a ${maxAchievableGPA} GPA.`
                        };
                    }
                    
                    return { 
                        error: "Goal is not achievable",
                        message: `Even with perfect grades (4.0) in ${planned} credit ${creditHourText}, you can only reach a ${maxAchievableGPA} GPA.`
                    };
                }

                if (requiredGPA < 0) {
                    return {
                        success: true,
                        message: `Great news! You've already exceeded your goal GPA. Your current GPA of ${current.toFixed(3)} is higher than your goal of ${goal.toFixed(3)}.`
                    };
                }

                let closestGrade = 'A';
                let minDiff = Math.abs(4.0 - requiredGPA);
                
                for (const [grade, points] of Object.entries(gradePoints)) {
                    if (points === null) continue;
                    const diff = Math.abs(points - requiredGPA);
                    if (diff < minDiff) {
                        minDiff = diff;
                        closestGrade = grade;
                    }
                }

                return {
                    success: true,
                    requiredGPA: requiredGPA.toFixed(3),
                    closestGrade: closestGrade,
                    gradeValue: gradePoints[closestGrade].toFixed(1),
                    message: requiredGPA <= 4.0 ?
                        `To reach your goal GPA of ${goal.toFixed(3)}, you need to earn an average of ${requiredGPA.toFixed(3)} across ${planned} credit ${creditHourText}. This is approximately a ${closestGrade} (${gradePoints[closestGrade].toFixed(2)}) average.` :
                        null
                };
            };

            const resetAllData = () => {
                if (window.confirm('Are you sure you want to clear all semesters and start over? This cannot be undone.')) {
                    localStorage.removeItem('mtsuGPAData');
                    initializeFirstSemester();
                }
            };

            if (semesters.length === 0) {
                return <div className="flex items-center justify-center min-h-screen">Loading...</div>;
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-blue-100 p-6">
                    {duplicateDialog && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                            <div className="bg-white rounded-lg shadow-xl max-w-md w-full p-6">
                                <h3 className="text-xl font-bold text-gray-800 mb-4">Repeat Course Detected</h3>
                                <p className="text-gray-700 mb-6">
                                    You've already entered "<strong>{duplicateDialog.duplicateName}</strong>". Are you retaking this course to improve your grade?
                                </p>
                                <div className="flex gap-3 justify-end">
                                    <button
                                        onClick={() => handleDuplicateResponse(false)}
                                        className="px-6 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition font-semibold"
                                    >
                                        No, remove it
                                    </button>
                                    <button
                                        onClick={() => handleDuplicateResponse(true)}
                                        className="px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition font-semibold"
                                    >
                                        Yes, I'm retaking it
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    <div className="max-w-6xl mx-auto">
                        <div className="bg-blue-600 text-white rounded-t-lg p-6 shadow-lg" style={{background: 'linear-gradient(135deg, #03045e 0%, #0077b6 100%)'}}>
                            <h1 className="text-3xl font-bold text-center">MTSU GPA Calculator</h1>
                            <p className="text-center mt-2" style={{color: '#90e0ef'}}>Middle Tennessee State University</p>
                            
                            <div className="flex flex-wrap justify-center gap-4 mt-4">
                                <button
                                    onClick={() => {
                                        setShowGoalPlanner(false);
                                        setShowCandidacy(false);
                                    }}
                                    className={`px-6 py-2 rounded transition ${
                                        !showGoalPlanner && !showCandidacy
                                            ? 'bg-white font-semibold'
                                            : 'hover:opacity-80'
                                    }`}
                                    style={!showGoalPlanner && !showCandidacy ? {color: '#03045e'} : {backgroundColor: '#0096c7', color: 'white'}}
                                >
                                    Calculate GPA
                                </button>
                                <button
                                    onClick={() => {
                                        setShowGoalPlanner(true);
                                        setShowCandidacy(false);
                                    }}
                                    className={`px-6 py-2 rounded transition ${
                                        showGoalPlanner && !showCandidacy
                                            ? 'bg-white font-semibold'
                                            : 'hover:opacity-80'
                                    }`}
                                    style={showGoalPlanner && !showCandidacy ? {color: '#03045e'} : {backgroundColor: '#0096c7', color: 'white'}}
                                >
                                    Goal Planner
                                </button>
                                <button
                                    onClick={() => {
                                        setShowGoalPlanner(false);
                                        setShowCandidacy(true);
                                    }}
                                    className={`px-6 py-2 rounded transition ${
                                        showCandidacy
                                            ? 'bg-white font-semibold'
                                            : 'hover:opacity-80'
                                    }`}
                                    style={showCandidacy ? {color: '#03045e'} : {backgroundColor: '#0096c7', color: 'white'}}
                                >
                                    Jones Candidacy
                                </button>
                            </div>
                        </div>

                        <div className="bg-white rounded-b-lg shadow-lg p-6">
                            {showCandidacy ? (
                                <>
                                    <div className="bg-blue-50 border-l-4 border-blue-600 p-4 mb-6 rounded">
                                        <h3 className="font-bold text-blue-900 mb-2">Jones College of Business - Pre-Business Course Requirement</h3>
                                        <p className="text-gray-700 mb-2">
                                            To be admitted to Jones College of Business (BBA programs), you need a <strong>2.25 GPA average</strong> across these four pre-business courses: ECON 2410, ECON 2420, BIA 2610, and ACTG 2110.
                                        </p>
                                        <p className="text-sm text-gray-600 italic">
                                            Note: You also need 30+ semester hours completed, an inclusive GPA ≥ 2.25, and to complete the Jones College Admission Application. This calculator focuses on the 4 pre-business course GPA requirement.
                                        </p>
                                    </div>

                                    <div className="grid md:grid-cols-2 gap-6 mb-6">
                                        {['ECON 2410', 'ECON 2420', 'BIA 2610', 'ACTG 2110'].map(course => (
                                            <div key={course}>
                                                <label className="block text-sm font-semibold text-gray-700 mb-2">
                                                    {course}
                                                </label>
                                                <select
                                                    value={candidacyGrades[course]}
                                                    onChange={(e) => setCandidacyGrades({
                                                        ...candidacyGrades,
                                                        [course]: e.target.value
                                                    })}
                                                    className="w-full px-4 py-3 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                >
                                                    <option value="">Not Taken Yet</option>
                                                    {Object.keys(gradePoints).filter(g => g !== 'FA' && g !== 'W').map(grade => (
                                                        <option key={grade} value={grade}>
                                                            {grade} ({gradePoints[grade].toFixed(2)})
                                                        </option>
                                                    ))}
                                                </select>
                                            </div>
                                        ))}
                                    </div>

                                    {(() => {
                                        const result = calculateCandidacyStatus();
                                        
                                        if (!result) {
                                            return (
                                                <div className="bg-gray-50 border-l-4 border-gray-400 p-6 rounded">
                                                    <p className="text-gray-600">Enter your grades above to see your candidacy status.</p>
                                                </div>
                                            );
                                        }
                                        
                                        if (result.success) {
                                            return (
                                                <div className="bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg p-6">
                                                    <h3 className="text-2xl font-bold mb-4 text-center">✓ Pre-Business Course Requirement Met!</h3>
                                                    <p className="text-lg leading-relaxed">{result.message}</p>
                                                    <div className="mt-6 bg-white/20 rounded p-4 text-center">
                                                        <p className="text-sm text-green-100">Your Pre-Business Course GPA</p>
                                                        <p className="text-4xl font-bold">{result.gpa}</p>
                                                    </div>
                                                </div>
                                            );
                                        }
                                        
                                        if (result.partial) {
                                            return (
                                                <div className="bg-gradient-to-r from-yellow-500 to-yellow-600 text-white rounded-lg p-6">
                                                    <h3 className="text-2xl font-bold mb-4 text-center">In Progress</h3>
                                                    <p className="text-lg leading-relaxed mb-4">{result.message}</p>
                                                    <div className="grid md:grid-cols-2 gap-4 mt-6">
                                                        <div className="bg-white/20 rounded p-4 text-center">
                                                            <p className="text-sm text-yellow-100">Current GPA</p>
                                                            <p className="text-3xl font-bold">{result.gpa}</p>
                                                            <p className="text-xs text-yellow-100 mt-1">{result.completed} of 4 courses</p>
                                                        </div>
                                                        <div className="bg-white/20 rounded p-4 text-center">
                                                            <p className="text-sm text-yellow-100">Target Grade Needed</p>
                                                            <p className="text-3xl font-bold">{result.neededGrade}</p>
                                                            <p className="text-xs text-yellow-100 mt-1">Average in remaining courses</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            );
                                        }
                                        
                                        if (!result.success) {
                                            return (
                                                <div className="bg-gradient-to-r from-red-500 to-red-600 text-white rounded-lg p-6">
                                                    <h3 className="text-2xl font-bold mb-4 text-center">Pre-Business Course Requirement Not Met</h3>
                                                    <p className="text-lg leading-relaxed mb-4">{result.message}</p>
                                                    <div className="grid md:grid-cols-3 gap-4 mt-6">
                                                        <div className="bg-white/20 rounded p-4 text-center">
                                                            <p className="text-sm text-red-100">Current GPA</p>
                                                            <p className="text-3xl font-bold">{result.gpa}</p>
                                                        </div>
                                                        <div className="bg-white/20 rounded p-4 text-center">
                                                            <p className="text-sm text-red-100">Course to Repeat</p>
                                                            <p className="text-xl font-bold">{result.lowestCourse}</p>
                                                            <p className="text-xs text-red-100 mt-1">Current: {result.currentGrade}</p>
                                                        </div>
                                                        <div className="bg-white/20 rounded p-4 text-center">
                                                            <p className="text-sm text-red-100">Grade Needed</p>
                                                            <p className="text-3xl font-bold">{result.neededGrade}</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            );
                                        }
                                        
                                        return null;
                                    })()}

                                    <div className="mt-6">
                                        <button
                                            onClick={() => setCandidacyGrades({
                                                'ECON 2410': '',
                                                'ECON 2420': '',
                                                'BIA 2610': '',
                                                'ACTG 2110': ''
                                            })}
                                            className="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition"
                                        >
                                            Reset Candidacy Calculator
                                        </button>
                                    </div>
                                </>
                            ) : !showGoalPlanner ? (
                                <>
                                    <div className="mb-6">
                                        <div className="flex flex-wrap gap-2 mb-4 items-center">
                                            {semesters.map((semester, index) => (
                                                <div key={semester.id} className="flex items-center gap-1 bg-gray-50 rounded-lg p-1">
                                                    <button
                                                        onClick={() => setActiveSemester(index)}
                                                        className={`px-4 py-2 rounded transition ${
                                                            activeSemester === index
                                                                ? 'text-white font-semibold shadow-md'
                                                                : 'bg-white text-gray-700 hover:bg-gray-100 border border-gray-300'
                                                        }`}
                                                        style={activeSemester === index ? {backgroundColor: '#0077b6'} : {}}
                                                    >
                                                        {semester.name}
                                                    </button>
                                                    <button
                                                        onClick={(e) => {
                                                            e.stopPropagation();
                                                            const newName = prompt('Enter semester name:', semester.name);
                                                            if (newName && newName.trim()) {
                                                                updateSemesterName(index, newName.trim());
                                                            }
                                                        }}
                                                        className="text-gray-500 hover:text-blue-600 p-1"
                                                        title="Edit semester name"
                                                    >
                                                        ✏️
                                                    </button>
                                                    {semesters.length > 1 && (
                                                        <button
                                                            onClick={(e) => {
                                                                e.stopPropagation();
                                                                if (window.confirm(`Delete "${semester.name}"?`)) {
                                                                    removeSemester(index);
                                                                }
                                                            }}
                                                            className="text-red-500 hover:text-red-700 p-1"
                                                            title="Delete semester"
                                                        >
                                                            <Trash2 size={16} />
                                                        </button>
                                                    )}
                                                </div>
                                            ))}
                                            <button
                                                onClick={addSemester}
                                                className="px-4 py-2 text-white rounded-lg hover:opacity-90 transition flex items-center gap-2 shadow-md"
                                                style={{backgroundColor: '#00b4d8'}}
                                            >
                                                <PlusCircle size={18} />
                                                Add Semester
                                            </button>
                                        </div>
                                    </div>

                                    <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                                        <div className="text-white rounded-lg p-4 text-center" style={{background: 'linear-gradient(135deg, #0077b6 0%, #0096c7 100%)'}}>
                                            <p className="text-sm mb-1">Cumulative GPA</p>
                                            <p className="text-3xl font-bold">{calculateCumulativeGPA()}</p>
                                        </div>
                                        <div className="text-white rounded-lg p-4 text-center" style={{background: 'linear-gradient(135deg, #00b4d8 0%, #48cae4 100%)'}}>
                                            <p className="text-sm mb-1">Semester GPA</p>
                                            <p className="text-3xl font-bold">{calculateSemesterGPA(activeSemester)}</p>
                                        </div>
                                        <div className="text-white rounded-lg p-4 text-center" style={{background: 'linear-gradient(135deg, #023e8a 0%, #0077b6 100%)'}}>
                                            <p className="text-sm mb-1">Credits Earned</p>
                                            <p className="text-3xl font-bold">{getTotalCredits().earned}</p>
                                        </div>
                                        <div className="text-white rounded-lg p-4 text-center" style={{background: 'linear-gradient(135deg, #0096c7 0%, #00b4d8 100%)'}}>
                                            <p className="text-sm mb-1">Credits Attempted</p>
                                            <p className="text-3xl font-bold">{getTotalCredits().attempted}</p>
                                        </div>
                                    </div>

                                    <div className="bg-blue-50 border-l-4 border-blue-600 p-4 mb-6 rounded">
                                        <p className="text-gray-700">
                                            Viewing: <strong>{semesters[activeSemester].name}</strong>. Add courses below and your GPA will calculate automatically. Data is saved automatically to your browser.
                                        </p>
                                    </div>

                                    <div className="overflow-x-auto">
                                        <table className="w-full mb-6">
                                            <thead>
                                                <tr className="bg-gray-100">
                                                    <th className="p-3 text-left font-semibold text-gray-700">Course Name</th>
                                                    <th className="p-3 text-left font-semibold text-gray-700">Credit Hours</th>
                                                    <th className="p-3 text-left font-semibold text-gray-700">Grade</th>
                                                    <th className="p-3 text-center font-semibold text-gray-700">Action</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {semesters[activeSemester].courses.map((course, index) => (
                                                    <tr key={course.id} className={index % 2 === 0 ? 'bg-white' : 'bg-gray-50'}>
                                                        <td className="p-3">
                                                            <input
                                                                type="text"
                                                                placeholder="e.g., MATH 1910"
                                                                value={course.name}
                                                                onChange={(e) => updateCourse(activeSemester, course.id, 'name', e.target.value)}
                                                                onBlur={(e) => {
                                                                    if (e.target.value.trim() !== '') {
                                                                        checkForDuplicate(activeSemester, course.id, e.target.value.trim());
                                                                    }
                                                                }}
                                                                className="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                            />
                                                        </td>
                                                        <td className="p-3">
                                                            <input
                                                                type="number"
                                                                placeholder="3"
                                                                min="0"
                                                                max="6"
                                                                step="0.5"
                                                                value={course.credits}
                                                                onChange={(e) => updateCourse(activeSemester, course.id, 'credits', e.target.value)}
                                                                onKeyPress={(e) => {
                                                                    if (!/[0-9.]/.test(e.key)) {
                                                                        e.preventDefault();
                                                                    }
                                                                }}
                                                                className="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                            />
                                                        </td>
                                                        <td className="p-3">
                                                            <select
                                                                value={course.grade}
                                                                onChange={(e) => updateCourse(activeSemester, course.id, 'grade', e.target.value)}
                                                                className="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                            >
                                                                <option value="">Select Grade</option>
                                                                {Object.keys(gradePoints).map(grade => (
                                                                    <option key={grade} value={grade}>
                                                                        {grade} {gradePoints[grade] !== null ? `(${gradePoints[grade].toFixed(2)})` : ''}
                                                                    </option>
                                                                ))}
                                                            </select>
                                                        </td>
                                                        <td className="p-3 text-center">
                                                            <button
                                                                onClick={() => removeCourse(activeSemester, course.id)}
                                                                disabled={semesters[activeSemester].courses.length === 1}
                                                                className={`p-2 rounded ${
                                                                    semesters[activeSemester].courses.length === 1
                                                                        ? 'text-gray-300 cursor-not-allowed'
                                                                        : 'text-red-600 hover:bg-red-50'
                                                                }`}
                                                            >
                                                                <Trash2 size={20} />
                                                            </button>
                                                        </td>
                                                    </tr>
                                                ))}
                                            </tbody>
                                        </table>
                                    </div>

                                    <div className="flex flex-wrap gap-4 mb-6">
                                        <button
                                            onClick={() => addCourse(activeSemester)}
                                            className="flex items-center gap-2 px-4 py-2 text-white rounded hover:opacity-90 transition"
                                            style={{backgroundColor: '#0077b6'}}
                                        >
                                            <PlusCircle size={20} />
                                            Add Course
                                        </button>
                                        <button
                                            onClick={resetAllData}
                                            className="px-4 py-2 text-white rounded hover:opacity-90 transition"
                                            style={{backgroundColor: '#48cae4'}}
                                        >
                                            Reset All
                                        </button>
                                    </div>
                                </>
                            ) : (
                                <>
                                    <div className="bg-blue-50 border-l-4 border-blue-600 p-4 mb-6 rounded">
                                        <p className="text-gray-700">
                                            Enter your current GPA and credit hours, then specify your goal GPA and how many credit hours you plan to take. We'll calculate what grades you need to achieve your goal.
                                        </p>
                                    </div>

                                    <div className="grid md:grid-cols-2 gap-6 mb-6">
                                        <div>
                                            <label className="block text-sm font-semibold text-gray-700 mb-2">
                                                Current GPA
                                            </label>
                                            <input
                                                type="number"
                                                placeholder="e.g., 3.25"
                                                min="0"
                                                max="4"
                                                step="0.0001"
                                                value={currentGPA}
                                                onChange={(e) => {
                                                    const val = e.target.value;
                                                    const numVal = parseFloat(val);
                                                    if (val === '' || (numVal >= 0 && numVal <= 4)) {
                                                        setCurrentGPA(val);
                                                    }
                                                }}
                                                onBlur={(e) => {
                                                    const val = parseFloat(e.target.value);
                                                    if (!isNaN(val)) {
                                                        setCurrentGPA(val.toFixed(4).replace(/\.?0+$/, ''));
                                                    }
                                                }}
                                                onKeyPress={(e) => {
                                                    if (!/[0-9.]/.test(e.key)) {
                                                        e.preventDefault();
                                                    }
                                                }}
                                                className="w-full px-4 py-3 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-semibold text-gray-700 mb-2">
                                                Current Total Credit Hours
                                            </label>
                                            <input
                                                type="number"
                                                placeholder="e.g., 45"
                                                min="0"
                                                step="0.5"
                                                value={currentCredits}
                                                onChange={(e) => setCurrentCredits(e.target.value)}
                                                className="w-full px-4 py-3 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-semibold text-gray-700 mb-2">
                                                Goal GPA
                                            </label>
                                            <input
                                                type="number"
                                                placeholder="e.g., 3.50"
                                                min="0"
                                                max="4"
                                                step="0.0001"
                                                value={goalGPA}
                                                onChange={(e) => {
                                                    const val = e.target.value;
                                                    const numVal = parseFloat(val);
                                                    if (val === '' || (numVal >= 0 && numVal <= 4 && /^\d*\.?\d{0,4}$/.test(val))) {
                                                        setGoalGPA(val);
                                                    }
                                                }}
                                                onKeyPress={(e) => {
                                                    if (!/[0-9.]/.test(e.key)) {
                                                        e.preventDefault();
                                                    }
                                                }}
                                                className="w-full px-4 py-3 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-semibold text-gray-700 mb-2">
                                                Planned Credit Hours
                                            </label>
                                            <input
                                                type="number"
                                                placeholder="e.g., 15"
                                                min="0"
                                                step="0.5"
                                                value={plannedCredits}
                                                onChange={(e) => setPlannedCredits(e.target.value)}
                                                className="w-full px-4 py-3 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                            />
                                        </div>
                                    </div>

                                    {currentGPA && currentCredits && goalGPA && plannedCredits && (() => {
                                        const result = calculateGoalGrade();
                                        
                                        if (result?.error) {
                                            return (
                                                <div className="bg-red-50 border-l-4 border-red-500 p-6 rounded">
                                                    <h3 className="text-lg font-semibold text-red-800 mb-2">{result.error}</h3>
                                                    {result.message && (
                                                        <p className="text-red-700">{result.message}</p>
                                                    )}
                                                </div>
                                            );
                                        }
                                        
                                        if (result?.success) {
                                            return (
                                                <div className="bg-gradient-to-r from-green-500 to-green-600 text-white rounded-lg p-6">
                                                    <h3 className="text-2xl font-bold mb-4 text-center">Your Goal Plan</h3>
                                                    <p className="text-lg leading-relaxed">{result.message}</p>
                                                    
                                                    {result.requiredGPA && (
                                                        <div className="mt-6 bg-white/20 rounded p-4">
                                                            <div className="grid md:grid-cols-2 gap-4 text-center">
                                                                <div>
                                                                    <p className="text-sm text-green-100">Required GPA</p>
                                                                    <p className="text-3xl font-bold">{result.requiredGPA}</p>
                                                                </div>
                                                                <div>
                                                                    <p className="text-sm text-green-100">Target Grade Average</p>
                                                                    <p className="text-3xl font-bold">{result.closestGrade}</p>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    )}
                                                </div>
                                            );
                                        }
                                        
                                        return null;
                                    })()}
                                </>
                            )}

                            <div className="mt-6 p-6 bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg border-2 border-blue-200 shadow-md">
                                <h3 className="text-lg font-bold text-blue-900 mb-4 flex items-center gap-2">
                                    <span className="text-2xl">📊</span>
                                    MTSU Grade Scale
                                </h3>
                                <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 mb-6">
                                    {Object.entries(gradePoints).filter(([grade]) => grade !== 'W').map(([grade, points]) => (
                                        <div key={grade} className="bg-white rounded-lg p-3 shadow-sm border border-blue-100 hover:shadow-md transition">
                                            <div className="flex justify-between items-center">
                                                <span className="font-bold text-blue-700 text-lg">{grade}</span>
                                                <span className="text-gray-700 font-semibold">{points.toFixed(2)}</span>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                <div className="bg-white rounded-lg p-4 border border-blue-200">
                                    <h4 className="font-semibold text-blue-800 mb-2">Grades That Do Not Affect GPA:</h4>
                                    <div className="grid md:grid-cols-2 gap-2 text-sm text-gray-700">
                                        <div><span className="font-semibold">I</span> - Incomplete</div>
                                        <div><span className="font-semibold">P</span> - Pass (Pass/Fail)</div>
                                        <div><span className="font-semibold">NC</span> - No Credit (Audit)</div>
                                        <div><span className="font-semibold">W</span> - Withdrawal</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<MTSUGPACalculator />, document.getElementById('root'));
    </script>
</body>
</html>